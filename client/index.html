{% extends "layout.html" %}

{% macro loading() %}
<div class="game__race-loader">LOADING</div>
{% endmacro %}

{% macro lastScreen(levels) %}
<div class="last-screen">
  <div class="last-screen__replay-btns">
    {% for level in levels %}
    {{ replayButton(level.slug, level.name) }}
    {% endfor %}
  </div>
  {% include "includes/share.html" %}
</div>
{% endmacro %}

{% macro comparison() %}
<div class="level__comparison">
THIS SHOWS THE COMPASION DATA
</div>
{% endmacro %}

{% macro replayButton(slug, label) %}
<button name="replay-level" value="{{ slug }}">{{ label }}</button>
{% endmacro %}

{% macro nextButton(name, num, src) %}
<button class="next-level-button" name="next-level">
  <img src="{{ src }}" alt="">
  <p>Next up, level {{ num }}: {{ name }}</p>
  <span class="next-level-button__target">I'm ready</span>
</button>
{% endmacro%}

{% macro statePanel(slug, state) %}
<div class="level__state level__state--{{slug}}" data-state="{{ state }}">
{{ caller() }}
</div>
{% endmacro %}

{% macro countdown(slug, text) %}
  {% set content=caller() %}
  {% call statePanel(slug, "countdown") %}
  <button class="countdown-status game__race-button" name="stopwatch-stop">WAIT</button>
  <div class="countdown-message">
    {{ content }}
  </div>
  {% endcall %}
{% endmacro %}

{% macro falseStart(slug) %}
  {% call statePanel(slug, "false-start") %}
  <p>False start</p>
  {{ replayButton(slug, "Try again") }}
  {% endcall %}
{% endmacro %}

{% macro normalStart(slug) %}
  {% call statePanel(slug, "normal-start") %}
  <p class="result-summary"></p>
  {% endcall %}
{% endmacro %}

{% macro noStart(slug) %}
  {% call statePanel(slug, "no-start") %}
  <p>What happened, you didn't leave blocks?</p>
  {{ replayButton(slug, "Restart") }}
  {% endcall %}
{% endmacro %}

{% macro clock(slug, d) %}

<div class="clock clock--{{ slug }}">
<div class="clock__display clock__event">{{ d }}</div>
<div class="clock__display clock__time" data-clock="{{ slug }}">0.00</div>
</div>
{% endmacro %}

{% block article_body %}


<ul class="level-icons">
{% for level in levels %}
  <li><i class="{{ level.slug }}"></i></li>
{% endfor %}
</ul>


<div class="play-button-wrapper">
  <b>Use headphones or turn up your sound!</b>
  <h2>
    LEVEL 1: Track cycling
  </h2>
  <p>Choose which event to enter</p>
  <button name="first-level" style="vertical-align:middle;display:inline-block;width:100px;height:100px">Mens<br/>event</button>
  <button name="first-level" style="vertical-align:middle;display:inline-block;width:100px;height:100px">Womens<br/>event</button>
</div>


{% for level in levels %}
  <div class="level" data-level="{{ level.slug }}">
    {{ clock(level.slug, level.clockname) }}
    {{ loading() }}
    <div class="level__states">
      {% call countdown(level.slug, level.countdownInstruction) %}
      {% if level.slug == 'cycle' %}
      <p>Counting down...</p>
      <p>5, 4, 3, 2, 1, Go!</p>
      {% elif level.slug == 'swim' %}
      <p>This one is quicker</p>
      <p>"Take you marks", "Go"</p>
      {% elif level.slug == 'sprint' %}
      <p>Listen for the gun</p>
      {% endif %}
      {% endcall %}
      <div class="level__complete">
        {{ normalStart(level.slug) }}
        {{ falseStart(level.slug) }}
        {{ noStart(level.slug) }}
        {{ comparison(level.slug) }}
        {% if not loop.last %}
        {{ nextButton(levels[loop.index0 + 1].sportname, loop.index + 1, level.nextimage, levels[loop.index0 + 1].slug) }}
        {% else %}
        {{ lastScreen(levels) }}
        {% endif %}
      </div>
    </div>
  </div>
{% endfor %}
{% endblock %}
